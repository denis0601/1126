<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D DNA 雙螺旋模擬</title>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* 隱藏捲軸 */
            background-color: #000; /* 黑色背景 */
            font-family: sans-serif;
        }
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            pointer-events: none; /* 讓滑鼠事件穿透文字 */
            z-index: 10;
            text-shadow: 1px 1px 2px black;
        }
    </style>
</head>
<body>

    <div id="info">
        <h2>3D DNA 結構模擬</h2>
        <p>使用滑鼠左鍵拖曳旋轉 | 滾輪縮放</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // --- 1. 場景初始化 ---
        const scene = new THREE.Scene();
        // 添加一些霧氣效果，讓遠處看起來深邃
        scene.fog = new THREE.FogExp2(0x000000, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 30;
        camera.position.y = 10;

        const renderer = new THREE.WebGLRenderer({ antialias: true }); // 開啟反鋸齒
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // --- 2. 添加光照 ---
        // 環境光 (整體亮度)
        const ambientLight = new THREE.AmbientLight(0x404040, 2); 
        scene.add(ambientLight);

        // 點光源 (產生高光和立體感)
        const pointLight = new THREE.PointLight(0xffffff, 1, 100);
        pointLight.position.set(10, 10, 20);
        scene.add(pointLight);
        
        const pointLight2 = new THREE.PointLight(0x00ccff, 0.8, 100);
        pointLight2.position.set(-10, -10, -10);
        scene.add(pointLight2);

        // --- 3. DNA 參數設定 ---
        const dnaGroup = new THREE.Group();
        scene.add(dnaGroup);

        const pairCount = 40;     // 鹼基對數量
        const radius = 4;         // 螺旋半徑
        const heightStep = 1.2;   // 每個鹼基對的高度間距
        const twist = 0.5;        // 每個鹼基對的旋轉角度 (弧度)

        // 建立幾何體與材質 (共用以提升效能)
        const sphereGeo = new THREE.SphereGeometry(0.6, 32, 32);
        const cylinderGeo = new THREE.CylinderGeometry(0.2, 0.2, radius * 2, 16);
        
        // 材質顏色
        const materialRed = new THREE.MeshPhongMaterial({ color: 0xff3333, shininess: 100 });
        const materialBlue = new THREE.MeshPhongMaterial({ color: 0x3333ff, shininess: 100 });
        const materialGold = new THREE.MeshPhongMaterial({ color: 0xffcc00, shininess: 100 }); // 骨架顏色
        const materialWhite = new THREE.MeshPhongMaterial({ color: 0xffffff, opacity: 0.5, transparent: true }); // 連接線

        // --- 4. 建構 DNA ---
        for (let i = 0; i < pairCount; i++) {
            const y = i * heightStep - (pairCount * heightStep) / 2; // 讓 DNA 居中
            const angle = i * twist;

            // 計算兩條螺旋鏈的 X, Z 座標
            const x1 = Math.cos(angle) * radius;
            const z1 = Math.sin(angle) * radius;
            
            const x2 = Math.cos(angle + Math.PI) * radius; // 對側相差 180度 (PI)
            const z2 = Math.sin(angle + Math.PI) * radius;

            // --- 建立骨架原子 (球體) ---
            const atom1 = new THREE.Mesh(sphereGeo, materialGold);
            atom1.position.set(x1, y, z1);
            dnaGroup.add(atom1);

            const atom2 = new THREE.Mesh(sphereGeo, materialGold);
            atom2.position.set(x2, y, z2);
            dnaGroup.add(atom2);

            // --- 建立鹼基對原子 (內部球體) ---
            // 我們在骨架內側一點的位置放鹼基
            const innerR = radius * 0.4;
            const ix1 = Math.cos(angle) * innerR;
            const iz1 = Math.sin(angle) * innerR;
            const ix2 = Math.cos(angle + Math.PI) * innerR;
            const iz2 = Math.sin(angle + Math.PI) * innerR;

            const base1 = new THREE.Mesh(sphereGeo, materialRed);
            base1.position.set(ix1, y, iz1);
            // 稍微縮小鹼基
            base1.scale.set(0.8, 0.8, 0.8); 
            dnaGroup.add(base1);

            const base2 = new THREE.Mesh(sphereGeo, materialBlue);
            base2.position.set(ix2, y, iz2);
            base2.scale.set(0.8, 0.8, 0.8);
            dnaGroup.add(base2);

            // --- 建立連接線 (氫鍵) ---
            // 將圓柱體旋轉並放置在兩點之間
            const connector = new THREE.Mesh(cylinderGeo, materialWhite);
            connector.position.set(0, y, 0);
            connector.rotation.y = -angle; // 配合螺旋角度旋轉
            connector.rotation.z = Math.PI / 2; // 轉成橫躺
            // 調整長度以適應半徑
            connector.scale.y = 1.0; 
            dnaGroup.add(connector);
        }

        // --- 5. 控制與動畫 ---
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // 啟用阻尼效果 (滑動感)
        controls.dampingFactor = 0.05;

        // 動畫循環函數
        function animate() {
            requestAnimationFrame(animate);

            // 自動旋轉 DNA 整體
            dnaGroup.rotation.y += 0.01;

            // 更新控制器
            controls.update();

            renderer.render(scene, camera);
        }

        // 處理視窗縮放
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // 開始動畫
        animate();
    </script>
</body>
</html>
